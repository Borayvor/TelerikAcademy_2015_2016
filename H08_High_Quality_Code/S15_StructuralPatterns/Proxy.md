# Proxy (Пълномощно)

### 1. Цел.
> Предоставя запазено място или заместител на друг обект, за да контролира достъпа до него.

### 2. Мотивация.
> Една причина за контролиране на достъпа до даден обект е да се отложи неговото създаване и инициализация, докато наистина се наложи 
да бъде ползван. Например един редактор на документи, който може да вгражда графични елементи в документите. Някои графични обекти, 
от рода на големите растерни изображения, може да са тежки за създаване. Отварянето на документите обаче трябва да става бързо, 
така че е добре да се избегне едновременното създаване на всички тежки обекти при отваряне на документа. Това всъщност не е необходимо, 
тъй като не всички от тези обекти ще са видими в документа по едно и също време.

> Тези ограничения биха предложили всеки тежък обект да се създава при поискване, което в този случай настъпва, когатоизображението 
стане видимо. Но какво да поставим в документа на мястото на изображението ? И как можем да скрием факта, че изображението се създава 
при поискване, така че да не усложняваме имплементацията на редактора ? Тази оптимизация не трябва да влияе на кода за страниране 
и форматиране например.

> Решението е да се използва друг обект, Proxy (Пълномощно), който да служи за заместител на истинското изображение. Пълномощното 
играе ролята на изображението и се грижи за инстанциирането му, когато е необходимо.

### 3. Приложимост.
> Приложимо е когато има нужда от по-гъвкава или по-сложна връзка към някой обект и обикновенна връзка не е достатъчна :
  * **Отдалеченото пълномощно (remote proxy)** предоставя локален представител на обект от друго адресно пространство.
  * **Виртуалното пълномощно (virtual proxy)** създава тежки обекти при поискване.
  * **Защитното пълномощно (protection proxy)** контролира достъпа до оригиналния обект.
  * **Смарт референцията (smart reference)** е заместителна проста връзка извършва допълнителни действия при осъществяване на 
  достъп до обекта.


### 4. Структура.
![схема](https://github.com/Borayvor/TelerikAcademy_2015_2016/blob/master/H08_High_Quality_Code/S15_StructuralPatterns/Diagrams/proxy.jpg)

### 5. Участници.
* **Proxy** :
    * поддържа референция, даваща възможност на пълномощното да достига до реалния обект. Proxy може да поддържа референция 
    към Subject, ако интерфейсите на RealSubject и Subject са еднакви.
    * Предоставя интерфейс, идентичен на този на Subject, така че пълномощното да може да бъде заменено от реалния обект.
    * контролира достъпа до реалния обект и може да бъде отговорен за създаването и изтриването му.
    * другите задължения зависят от вида на пълномощното:
        * _отдалечените пълномощни_ са отговорни за закодирането на дадена заявка и нейните аргументи и изпращането на 
        кодираната заявка към истинския обект в друго адресно пространство.
        * _виртуалните пълномощни_ може да кешират допълнителната информация относно реалния обект, за да могат да отложат 
        осъществяването на достъп до него.
        * _защитните пълномощни_ проверяват дали извикващият обект има подходящи разрешения за достъп, за да изпраща заявка.
    
* **Subject** :
    * дефинира общия интерфейс за RealSubject и  Proxy, така че Proxy да може да се използва навсякъде, където се очаква RealSubject.

* **RealSubject** :
    * дефинира реалния обект, представляван от пълномощното.

### 6. Взаимодействия.
> Когато е необходимо, Proxy препредава заявки към RealSubject в зависимост от вида на пълномощното.

### 7. Следствия.
> Шаблонът Пълномощно въвежда ниво на индирекция при достъпа до даден обект. Допълнителната индирекция е с различни цели в зависимост 
от вида на пълномощното :
  * Отдалеченото пълномощно може да скрие факта, че даден обект се намира в друго адресно пространство.
  * Виртуалното пълномощно може да извърши оптимизации, например създване на обект при поискване.
  * Както защитните пълномощини, така и смарт референциите дават възможност за извършване на допълнителни системни задачи при 
  осъществяване на достъп до обектите.

### 8. Примерен код.
```
using System;
 
namespace DoFactory.GangOfFour.Proxy.Structural
{
  /// <summary>
  /// MainApp startup class for Structural
  /// Proxy Design Pattern.
  /// </summary>
  class MainApp
  {
    /// <summary>
    /// Entry point into console application.
    /// </summary>
    static void Main()
    {
      // Create proxy and request a service
      Proxy proxy = new Proxy();
      proxy.Request();
 
      // Wait for user
      Console.ReadKey();
    }
  }
 
  /// <summary>
  /// The 'Subject' abstract class
  /// </summary>
  abstract class Subject
  {
    public abstract void Request();
  }
 
  /// <summary>
  /// The 'RealSubject' class
  /// </summary>
  class RealSubject : Subject
  {
    public override void Request()
    {
      Console.WriteLine("Called RealSubject.Request()");
    }
  }
 
  /// <summary>
  /// The 'Proxy' class
  /// </summary>
  class Proxy : Subject
  {
    private RealSubject _realSubject;
 
    public override void Request()
    {
      // Use 'lazy initialization'
      if (_realSubject == null)
      {
        _realSubject = new RealSubject();
      }
 
      _realSubject.Request();
    }
  }
}
```
